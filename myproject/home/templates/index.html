{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="{% static 'styles.css' %}" />
  <title>Recreo</title>
</head>
<body>
  <!-- Top navigation bar -->
  <nav class="navbar">
    <div class="navbar-content">
      <img src="{% static 'recreo.jpg' %}" alt="Recreo Logo" class="nav-logo">
      <ul class="nav-menu">
        <li><a href="#">About</a></li>
        <li><a href="#">Activities</a></li>
        <li><a href="#">Contact</a></li>
      </ul>
      <div class="navbar-extra">
        <span class="navbar-cta">Your adventure awaits</span>
      </div>
    </div>
  </nav>

  <!-- Hero section -->
  <header class="hero-section" style="background-image: url('{% static 'hero_bg.jpg' %}');">
    <div class="hero-overlay">
      <h1 class="hero-title">RECREO</h1>
      <p class="hero-subtitle">Get outdoors and discover new experiences</p>
      <div class="hero-buttons">
        <button id="share-location-button" class="btn-primary">Share Location</button>
        <a href="{% url 'activities' %}" class="activity-btn">See Activities</a>
        <button id="input-location-toggle" class="btn-primary">Input Location</button>
      </div>
      <form id="manual-location-form" method="post" action="{% url 'save_text_location' %}" style="display:none; margin-top: 1em;">
        {% csrf_token %}
        <input type="text" name="city" id="input-city" placeholder="City (e.g., Denver)" required style="margin-right:0.5em;" />
        <input type="text" name="state" id="input-state" placeholder="State (e.g., CO)" required maxlength="2" style="margin-right:0.5em;" />
        <button type="submit" class="btn-primary">Save Location</button>
      </form>
    </div>
  </header>

  <!-- Welcome / App Highlight Section -->
  <main>
    <section class="welcome-section">
      <h2>Welcome to the Recreo Project</h2>
      <p>
        Recreo is your go-to app for discovering outdoor adventuresâ€”whether that's playing pickleball with friends or finding a peaceful hiking trail.
      </p>
      <div class="feature-icons">
        <div>
          <img src="{% static 'icon_trail.svg' %}" alt="Trail icon" />
          <p>Find Trails</p>
        </div>
        <div>
          <img src="{% static 'icon_friends.svg' %}" alt="Friends icon" />
          <p>Play with Friends</p>
        </div>
        <div>
          <img src="{% static 'icon_events.svg' %}" alt="Events icon" />
          <p>Discover Events</p>
        </div>
        <div>
          <img src="{% static 'icon_location.svg' %}" alt="Location icon" />
          <p>Nearby Activities</p>
        </div>
      </div>
    </section>

    <!-- Optional: Your existing location section, styled as card -->
    <section class="location-section" id="location">
      <h2>Your Location</h2>
      {% if coords %}
        <div class="location-display">
          {% if coords.city or coords.state %}
            <p><strong>City:</strong> {{ coords.city }}</p>
            <p><strong>State:</strong> {{ coords.state }}</p>
          {% else %}
            <p><strong>Latitude:</strong> {{ coords.lat }}</p>
            <p><strong>Longitude:</strong> {{ coords.lon }}</p>
          {% endif %}
          <a href="{% url 'activities' %}" class="activity-btn">See Nearby Activities</a>
        </div>
      {% else %}
        <form method="post" action="{% url 'save_text_location' %}" class="location-input-form">
          {% csrf_token %}
          <label for="city">City:</label>
          <input type="text" id="city" name="city" placeholder="e.g., Colorado Springs" required />
          <label for="state">State:</label>
          <input type="text" id="state" name="state" placeholder="e.g., CO" required maxlength="2" />
          <button type="submit" class="btn-secondary">Save Location</button>
        </form>
        <p class="no-location">No location saved yet.</p>
      {% endif %}
    </section>
  </main>

  <footer>
    <p>Created by Team 5 - 10/6/25</p>
  </footer>

<script>
  function getCookie(name) {
    const value = `; ${document.cookie}`;
    const parts = value.split(`; ${name}=`);
    if (parts.length === 2) return parts.pop().split(';').shift();
  }

  async function detectAndShareLocation() {
    if (!navigator.geolocation) {
      alert("Geolocation not supported by your browser.");
      return;
    }

    try {
      const pos = await new Promise((resolve, reject) => {
        navigator.geolocation.getCurrentPosition(resolve, (error) => {
          switch(error.code) {
            case error.PERMISSION_DENIED:
              alert("Location access denied. Please allow location access to share your location.");
              break;
            case error.POSITION_UNAVAILABLE:
              alert("Location information is unavailable.");
              break;
            case error.TIMEOUT:
              alert("Location request timed out.");
              break;
            default:
              alert("An unknown geolocation error occurred.");
          }
          reject(error);
        });
      });

      const res = await fetch("{% url 'save_location' %}", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "X-CSRFToken": getCookie("csrftoken")
        },
        body: JSON.stringify({
          lat: pos.coords.latitude,
          lon: pos.coords.longitude
        })
      });

      const data = await res.json();
      if (data.ok) {
        alert("Location shared successfully!");
        location.reload();
      } else {
        alert("Failed to save location.");
      }
    } catch (error) {
      console.error("Geolocation error:", error);
    }
  }

  document.getElementById('share-location-button').addEventListener('click', detectAndShareLocation);

  document.getElementById("input-location-toggle").addEventListener("click", function() {
    const form = document.getElementById("manual-location-form");
    form.style.display = (form.style.display === "none" || !form.style.display) ? "block" : "none";
    if (form.style.display === "block") {
      document.getElementById("input-city").focus();
    }
  });
</script>
</body>
</html>
