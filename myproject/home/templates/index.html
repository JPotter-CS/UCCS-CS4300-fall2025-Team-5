{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="{% static 'styles.css' %}" />
    <title>Recreo</title>
</head>

<body>
    <header class="header-bar">
        <div class="header-left">
            <button id="hamburger" aria-label="Menu">&#9776;</button>
            <img src="{% static 'recreo.jpg' %}" alt="Recreo Logo" class="site-logo">
        </div>
        <h1 class="site-title">Welcome to the Recreo Project.</h1>
        <div class="header-right"></div>
    </header>

    <!-- Hamburger menu -->
    <div id="menu" class="menu-hidden">
        <ul>
            <li><button id="share-location-button">Share Location</button></li>
        </ul>
    </div>

    <main>
        <p>
            This app is the future of helping you get outside and experience all the activities the world
            has to offer, whether that's playing pickleball with friends, or going on a nice solo hike. Recreo
            can help you find whatever suits you best.
        </p>

        <!-- Location Feature Section -->
        <div class="location-section">
            <h2>Your Location</h2>

            {% if coords %}
        <div class="location-display">
            {% if coords.city or coords.state %}
                <p><strong>City:</strong> {{ coords.city }}</p>
                <p><strong>State:</strong> {{ coords.state }}</p>
            {% else %}
                <p><strong>Latitude:</strong> {{ coords.lat }}</p>
                <p><strong>Longitude:</strong> {{ coords.lon }}</p>
            {% endif %}
            <a href="{% url 'activities' %}" class="activity-btn">See Nearby Activities</a>
        </div>
        {% else %}
        <p class="no-location">No location saved yet.</p>
        {% endif %}



        </div>
    </main>

    <!-- Image Section -->
    <div class="image-gallery">
        <img src="{% static 'beachvolley.jpg' %}" alt="Beach Volleyball" class="project-image" />
        <img src="{% static 'golfcourse.jpg' %}" alt="Golf Course" class="project-image" />
        <img src="{% static 'basketball.jpg' %}" alt="Basketball" class="project-image" />
    </div>

    <footer>
        <p>Created by Team 5 - 10/6/25</p>
    </footer>

    <script>
        function getCookie(name) {
            const value = `; ${document.cookie}`;
            const parts = value.split(`; ${name}=`);
            if (parts.length === 2) return parts.pop().split(';').shift();
        }

        document.getElementById('hamburger').addEventListener('click', () => {
            const menu = document.getElementById('menu');
            menu.classList.toggle('menu-visible');
        });

        async function detectAndShareLocation() {
            if (!navigator.geolocation) {
                alert("Geolocation not supported by your browser.");
                return;
            }

            try {
                const pos = await new Promise((resolve, reject) => {
                    navigator.geolocation.getCurrentPosition(resolve, reject);
                });

                const res = await fetch("{% url 'save_location' %}", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        "X-CSRFToken": getCookie("csrftoken")
                    },
                    body: JSON.stringify({
                        lat: pos.coords.latitude,
                        lon: pos.coords.longitude
                    })
                });

                const data = await res.json();
                if (data.ok) {
                    alert("Location shared successfully!");
                    location.reload();
                } else {
                    alert("Failed to save location.");
                }
            } catch (error) {
                alert("Location access denied or error occurred.");
            }
        }

        document.getElementById('share-location-button').addEventListener('click', () => {
            detectAndShareLocation();
            document.getElementById('menu').classList.remove('menu-visible');
        });
    </script>
</body>

</html>
